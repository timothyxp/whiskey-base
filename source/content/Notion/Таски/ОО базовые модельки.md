---
Status: Done
Priority:
  - High
---
  

|   |   |   |   |   |   |
|---|---|---|---|---|---|
|model|about_pr|ment_pr|not_about_pr|acc|graph|
|baseline|79.1|67.62|77.45|74.29|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/d1adeae0-fd66-4ca2-84f3-57a3bffffef0/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/d1adeae0-fd66-4ca2-84f3-57a3bffffef0/graph)|
|onetarget_L|79.25|68.34|85.04|76.45(==+2.16==)|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/cdf87d53-876d-4002-9820-5927e3bd07b3/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/cdf87d53-876d-4002-9820-5927e3bd07b3/graph)|
|msetarget_L|82.16|65.69|83.35|75.82(==+1.53==)|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/862d0773-a9e7-422a-b14d-bf178928275b/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/862d0773-a9e7-422a-b14d-bf178928275b/graph)|
|onetarget_XL|80.16|69.7|83.64|77.14(==+2.85==)|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/7d885ce1-a4e6-4b08-9ca2-e6bef46748c6/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/7d885ce1-a4e6-4b08-9ca2-e6bef46748c6/graph)|
|||||||

- доверительные интервалы скорее всего оч большие(еще посчитаю), корреляция вала с тестом оч плохая, поэтому брать best c вала не работало

  

Пробовал исходные пуля для обучения, после того как убрал фильтр по екому добавилось всего 3 документа

Для второго куска пула пула:  
Граф без фильтра -  
[https://nirvana.yandex-team.ru/flow/d4e81dec-3d18-429f-a025-b476b23befbe/01895c33-1e3e-4a08-81e1-58aa95653cb5/graph](https://nirvana.yandex-team.ru/flow/d4e81dec-3d18-429f-a025-b476b23befbe/01895c33-1e3e-4a08-81e1-58aa95653cb5/graph)  
С фильтром -  
[https://nirvana.yandex-team.ru/flow/d4e81dec-3d18-429f-a025-b476b23befbe/cf65a843-bd08-4564-9877-27f7a7fe4103/graph](https://nirvana.yandex-team.ru/flow/d4e81dec-3d18-429f-a025-b476b23befbe/cf65a843-bd08-4564-9877-27f7a7fe4103/graph)

Для первого куска пула:

граф без фильтра - [https://nirvana.yandex-team.ru/flow/d4e81dec-3d18-429f-a025-b476b23befbe/2a7c6ade-d3d6-464a-be27-cbbbedf14005/graph](https://nirvana.yandex-team.ru/flow/d4e81dec-3d18-429f-a025-b476b23befbe/2a7c6ade-d3d6-464a-be27-cbbbedf14005/graph)

С фильтром - [https://nirvana.yandex-team.ru/flow/d4e81dec-3d18-429f-a025-b476b23befbe/b1aba0d4-8bc3-49bc-9023-486b3ca9f774/graph](https://nirvana.yandex-team.ru/flow/d4e81dec-3d18-429f-a025-b476b23befbe/b1aba0d4-8bc3-49bc-9023-486b3ca9f774/graph)

  

Помимо этого самих доков стало меньше(видимо из-за нового стейта базы Юпитера ?), нужно видимо откатить версию

Уточнил на счет екома, он появился в большой объеме только в ноябре, а разметка собиралась в августе, поэтому карточек так мало.  
Итого пересобирать пулы смысла не имеет до появления новой разметки на еком  

  

### Про валидацию

Заметил что корреляция теста с валом оч плохая, попробовал посчиатать доверительный интервал по тесту, вышло что-то около +-1.31 accuracy при оценке бутстрапом.

Так как хочется иметь разброс меньше и на вал все равно при обучении не смотрю смержил вал с тестом увеличив в 2 раза выборку для тестового замера, теперь доверительный интервал выходит +-0.9, в sqrt(2) раза уменьшили как и ожидалось.

Далее все пересчитал на большем тестовом пуле, по классам писал F1 метрику тк для задач дистиляции(см описание тикета) для первой задачи важен скорее recall, а для второй precision. И хочется оптимизировать и то и то

### По данным

Попробовал добавить куфуфы на тайтлы

Замеры квантилей всего входа текущей модельки, [ыкль](https://yql.yandex-team.ru/Operations/Y-Ybufk8fR1VgxqTXvsk3uRuQMHFHlVucXYPJ6pw5CE=)

#|  
|| input | q10 | q25 | q50 | q75 | q90 | q95 | q99 ||  
|| Text common | 243 | 309 | 383 | 457 | 522 | 569 | 710 ||  
|| Text with qfufs | 294 | 362 | 438 | 514 | 584 | 635 | 767 ||  
|#  

### По экспериментам

- пробовал также seq_len увеличивать для Large и XLarge, ничего не дало
- если пробовать оптимайзить границы при mse таргете ничего не дает 75.75→75.82 accuracy  
    зато если максимизировать F1 в начале витальника, а потом крэпа можно получить на них сравнимое качество с CE(эксп mse_target_L_opt_borders)  
    
- XL незначимо лучше Large
- куфуфы только ухудшают скор(для них max_len поднимал чтоб все лезло), скорее всего из-за большого сходства с дефинами
- дофайнтьюниваться в начале на старой разметке, а потом уже на новую немного докидывает(суффикс old_ds_ft)
- distilce лучше mse(проверяю)

  

|   |   |   |   |   |   |
|---|---|---|---|---|---|
|model|about_pr|ment_pr|not_about_pr|acc|graph|
|baseline|73.25|69|78.28|73.11|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/767acdcb-3402-4831-aaf1-e554a0d60acc/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/767acdcb-3402-4831-aaf1-e554a0d60acc/graph)|
|onetarget_L|76.78|71.43|**83.48**|**76.66**|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/aa162d5a-7bd9-4d0f-b661-d9777f2cd2bc/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/aa162d5a-7bd9-4d0f-b661-d9777f2cd2bc/graph)|
|msetarget_L|76.45|69.82|83.2|75.75|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/68cb6fed-8b17-486e-812e-04bca5ccb5c5/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/68cb6fed-8b17-486e-812e-04bca5ccb5c5/graph)|
|mse_target_L_opt_borders|76.93|68.16|83.38|75.49|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/68cb6fed-8b17-486e-812e-04bca5ccb5c5/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/68cb6fed-8b17-486e-812e-04bca5ccb5c5/graph)|
|onetarget_XL|76.6|71.59|83.83|**76.68**|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/b839ce07-b61e-480d-a0ab-264dc0c659dc/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/b839ce07-b61e-480d-a0ab-264dc0c659dc/graph)|
|onetarget_L_seqlen=512|76.6|71.12|83.73|76.51|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/ff49540d-451d-4598-a089-f30f6244a208/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/ff49540d-451d-4598-a089-f30f6244a208/graph)|
|onetarget_L_qfuf_seqlen=512|76.57|70.91|83.35|76.35|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/772360db-8a1d-497b-abdf-fd2b8016c98e/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/772360db-8a1d-497b-abdf-fd2b8016c98e/graph)|
|onetarget_XL_old_ds_ft|77.05|71.64|83.27|**76.77**|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/9196743d-0e0d-4346-95ae-290f7578f1ac/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/9196743d-0e0d-4346-95ae-290f7578f1ac/graph)|
|msetarget_XL_old_ds_ft|76.62|69.77|83.62|75.86|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/a3ad09d4-65e0-4d2b-a302-6465e1a79284/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/a3ad09d4-65e0-4d2b-a302-6465e1a79284/graph)|
|msetarget_XL_old_ds_ft_opt_border|77.66|69|83.62|76.11|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/a3ad09d4-65e0-4d2b-a302-6465e1a79284/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/a3ad09d4-65e0-4d2b-a302-6465e1a79284/graph)|
|onetarget_L_distilce|**78.81**|69.94|83.17|75.91|[https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/e72362c9-05ec-4bd4-9c36-a8e762f268e7/graph](https://nirvana.yandex-team.ru/flow/4156e870-0581-41a4-b403-b039b76f2f95/e72362c9-05ec-4bd4-9c36-a8e762f268e7/graph)|

  

- [x] последовательные файн-тьюны  
    перебирал разные лр на старых/новых данных, конечный лр на старых данных  
    
- [x] попробовать длину побольше  
    пока тестил нашел заодно причину расхождений замеров YNMT и TF предиктов, seq_len в предикт кубике был не как в YNMT. После фикса все ок  
    
- [x] куфуфы на тайтлы
- [x] попробовать релевы по тайтлу
- [x] списаться с Андрюхой по текстам карточек

  

попробовал перебрать границы классов при mse таргете, ничего не дало

  

  

- разметку они делают, предложить что докинуть
- досмотреть примеры
- начать спрашивать про дистиляцию, спросить про то как собирался, зачем эмбеды из юпитера  
      
    

  

  

перебор параметров двойного файн-тьюна для классификации на 3 класса

|   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|
|neps1|lr1|elr1|neps2|lr2|f1|acc|
|1|1e-5|1e-7|2|2e-5|76.5/70.6/83.2|76.12|
|1|2e-5|1e-7|2|2e-5|77.27/70/83.1|76.26|
|1|7e-6|1e-7|2|2e-5|76.8/70.7/83.4|76.41|
|1|5e-6|1e-7|2|2e-5|76.27/69.9/83.1|75.83|
|1|5e-6|0|2|2e-5|77/70.6/83.6|76.5|
|1|7e-6|0|2|2e-5|77/71.6/83.3|76.77|
|1|1e-5|0|2|2e-5|76.9/70.8/83.2|76.37|
|2|1e-5|0|2|2e-5|76.4/69.3/82.4|75.5|
|2|7e-6|0|2|2e-5|76.8/70.5/83.5|76.3|
|2|5e-6|0|2|2e-5|76.8/70.3/82.97|76.15|
|2|3e-6|0|2|2e-5|76.8/70.3/83.5|76.28|
|1|7e-6|2e-6|2|2e-5|76.7/70.4/83|76.12|
|1|8e-6|2e-6|2|2e-5|76.5/69.6/82.7|75.68|
|1|9e-6|2e-6|2|2e-5|76.4/69.8/82.5|75.72|
|1|7e-6|1e-6|2|1e-5|77.3/69.8/82.8|76.17|
|1|7e-6|1e-6|2|3e-5|76.4/71.1/83.1|76.35|
|1|7e-6|1e-6|2|8e-6|76.6/69.8/82.7|75.93|
|1|7e-6|1e-6|2|6e-6|76.9/69.5/82.8|75.9|
|1|7e-6|1e-6|1|1e-5|77.6/70.3/83.2|76.59|
|1|7e-6|1e-6|1|2e-5|76.9/70.1/83.2|76.24|

  

base pre - [https://nirvana.yandex-team.ru/data/f00407c7-e41f-4eaf-860c-9aa2e063fd3b](https://nirvana.yandex-team.ru/data/f00407c7-e41f-4eaf-860c-9aa2e063fd3b)

base post - [https://nirvana.yandex-team.ru/data/887073f0-f995-4b70-a945-ec36e112b4ab](https://nirvana.yandex-team.ru/data/887073f0-f995-4b70-a945-ec36e112b4ab)