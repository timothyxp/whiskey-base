---
Created: 2022-10-26T16:51
---
[![](https://www.notion.so)](https://www.notion.so)

  

- [x] tokenizer_type=wordpiece
- [ ] ‚Äîln_dtype
- [x] ln_ytf_impl
- [x] attn_softmax_ytf_impl
- [x] FusedLAMB
- [x] grad_accum_dtype
- [x] memory_optimization
- [x] suppress_grappler
- [x] enable_resource_variables
- [x] custom_memory_optimization +state_split_strategy
- [x] split_grad_accum
- [x] hidden_dropout_prob (—ç–∫–æ–Ω–æ–º–∏—Ç –ø–∞–º—è—Ç—å, —Ç–æ—Ä—á —É—Å–∫–æ—Ä—è–µ—Ç)
- [x] attention_probs_dropout_prob - –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ
- [x] use_bias_in_keys (–≤ xl =False, –æ–±—ã—á–Ω–æ True, –≤—Ä–æ–¥–µ —Ç—É–ø–æ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏)
- [x] ytf_gelu / geglu
- [ ] –∏ –¥–∞–ª—å—à–µ tensor_parallel_size , —Ç–æ –µ—Å—Ç—å TP - –ª–æ–∫–∞–ª—å–Ω–æ –ø–æ–∫–∞ –∑–∞–≤–µ–ª, –≤ –Ω–∏—Ä–≤–∞–Ω–µ —Ç—Ä–∞–±–ª—ã

  

–ª–æ–∫–∞–ª—å–Ω—ã–π –±–µ–Ω—á

|—Å—ç—Ç–∞–ø|max gb|examples/sec|
|---|---|---|
|base|16|28.24|
|fused attn|14.6(-10%)|28.81(+2%)|
|fused lamb|14.9(-7%)|29.26(+3%)|
|fused attn + lamb|13.5(-18.5%)|29.73(+5%)|
|fused attn + lamb + resource vars|13.8(-16%)|29.1(+3%)|

resource vars

  

## nirvana bench

–î–ª—è –Ω–∞—á–∞–ª–∞ –≤—Å–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª–æ—Å—å –Ω–∞ Large –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –Ω–∞ –æ–¥–Ω–æ–π –Ω–æ–¥–µ —Å 8-—é –ê100-80G –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –∏–Ω–æ–µ

|—Å—ç—Ç–∞–ø|max gb|examples/sec|–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π|–≥—Ä–∞—Ñ|
|---|---|---|---|---|
|baseline|69.4|32.5||[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/6edd7300-4f5f-4185-9bd2-b78713841a5f/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/6edd7300-4f5f-4185-9bd2-b78713841a5f/graph)|
|fp16|45.6|36.2||[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/23512ecd-8bc9-47d6-b7b5-9c8f760e06cb/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/23512ecd-8bc9-47d6-b7b5-9c8f760e06cb/graph)|
|fp16+xla|45.8|76.26||[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/2753dc2e-7d3d-4022-b85e-c49548b6ccf0/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/2753dc2e-7d3d-4022-b85e-c49548b6ccf0/graph)|
|fp+16+xla+hvdfp16=**base**|49.0|76.34|hvd_fp16_compres=True, —É—Ö—É–¥—à–∏–ª –≤ –¥–∞–Ω–Ω–æ–º —Å—ç—Ç–∞–ø–µ|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/ab430409-a1cb-43de-add9-d372ad00ccc6/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/ab430409-a1cb-43de-add9-d372ad00ccc6/graph)|
|fp+16+xla+hvdfp16+wordpiece|49.0|75.8|wordpiece tokenizer, —ç—Ñ—Ñ–µ–∫—Ç–∞ –Ω–µ –¥–∞–µ—Ç|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d7248074-66f8-49e3-a27b-72c691c8e3a5/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d7248074-66f8-49e3-a27b-72c691c8e3a5/graph)|
||||||
|**–ß—Ç–æ-—Ç–æ —Å fused ln**|||||
|base+ln-ytf|51.4|73.3|–æ—á —Å—Ç—Ä–∞–Ω–Ω–æ, —É—Ö—É–¥—à–∞–µ—Ç –ø–∞–º—è—Ç—å ü§Ø|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/428a872d-ef45-43ef-9c87-e299849e609e/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/428a872d-ef45-43ef-9c87-e299849e609e/graph)|
|base+ln-ytf-fixed|51.5|73.5|–Ω–µ–±–æ–ª—å—à–æ–π —Ñ–∏–∫—Å –≤–ª–∏–ª, –±–µ–∑ —ç—Ñ—Ñ–µ–∫—Ç–∞|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/f6218b68-9239-483b-97bf-0eedf2d12b3f/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/f6218b68-9239-483b-97bf-0eedf2d12b3f/graph)|
|base+ln-ytf-old|50.5|72.9|–ø–æ–ø—Ä–æ–±–æ–≤–∞–ª –æ—Ç trunk|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/3839aba4-bd11-4c72-9c35-09c07781a623/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/3839aba4-bd11-4c72-9c35-09c07781a623/graph)|
|base+ln-ytf-old-old-layer|50.5|73,1|—Ç–æ–∂ —Å–∞–º–æ–µ, –Ω–æ –∏ —Å—Ç–∞—Ä—ã–π –ø–æ—Ä—Ç–æ—Å–ª–æ–π –Ω–∞ –≤—Å—è–∫–∏–π. **–î–∏—Å–∫–ª–µ–π–º–µ—Ä**: –∫–æ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–ª –∫ **base** –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤—Å–µ —É—Ö—É–¥—à–∞–ª–æ, –µ—Å–ª–∏ —É–±–∏—Ä–∞—Ç—å –∏–∑ **optimal** —Ç–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ö—É–∂–µ. –í –∏—Ç–æ–≥–µ –ø—Ä–æ—Ñ–∏—Ç –¥–∞–µ—Ç –µ—Å–ª–∏ –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ —Ñ—å—é–∑–¥–∞–º–∏|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/e37b6ce9-59a8-4050-b6f6-b9f608153422/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/e37b6ce9-59a8-4050-b6f6-b9f608153422/graph)|
||||||
|**–û—Å—Ç–∞–ª—å–Ω—ã–µ Fused**|||||
|base+fattsoftmax|43.6|77.2||[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/f2c3e816-136e-4469-8a76-471146d3de72/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/f2c3e816-136e-4469-8a76-471146d3de72/graph)|
|base+flamb|46.3|76.7||[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/0856adc9-a334-4c0a-b4ec-2c2d7dbedfe6/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/0856adc9-a334-4c0a-b4ec-2c2d7dbedfe6/graph)|
|base+f{attn+lamb+ln}=**basef**|37.9|76.4||[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/1ea0986b-90b4-4b42-a7cd-8cd7e88762c8/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/1ea0986b-90b4-4b42-a7cd-8cd7e88762c8/graph)|
|base+f{attn+lamb+ln+gelu}|30.8|79.9|—Å–∞–º—ã–π –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª –∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ –∂–µ|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/aaac3520-7850-4a66-9d28-6d84b44d48c5/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/aaac3520-7850-4a66-9d28-6d84b44d48c5/graph)|
||||||
|**Memory Optimization**|||||
|basef+default|37.9|77.5||[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/a30b2098-3b35-4ecf-86e1-6341c7710715/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/a30b2098-3b35-4ecf-86e1-6341c7710715/graph)|
|basef+heuristic|32.06|75.4||[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/22e5ca31-84a4-4fe0-8a75-ee71e63a5364/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/22e5ca31-84a4-4fe0-8a75-ee71e63a5364/graph)|
|basef+recomputations|31.8|75.6|–ø—Ä–∏ –¥–æ–±–∞–≤–∫–µ –∫ basef —É–ª—É—á—à–∞—é—Ç, –¥–∞–ª–µ–µ –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ —á—Ç–æ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fused-gelu, —Ç–æ –ø—Ä–æ—Ñ–∏—Ç–∞ –Ω–µ—Ç|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/b824b950-93eb-4d61-90fb-0227332dd8dd/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/b824b950-93eb-4d61-90fb-0227332dd8dd/graph)|
|basef+scheduling|37.9|77.4|—É—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è —á—Ç–æ –¥–µ–ª–∞–µ—Ç offloading, –ª–∏–±–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç c FusedLAMB, –ª–∏–±–æ –Ω–∞–¥–æ —Å–æ–∑–¥–∞—Ç—å OOM —á—Ç–æ–± –æ–Ω –Ω–∞—á–∞–ª —á—Ç–æ-—Ç–æ –≤—ã–≥—Ä—É–∂–∞—Ç—å, TODO|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/fd42235b-0fa3-49cd-acf8-ef3c60f11287/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/c9f54d79-2a69-4264-ad7d-02a7de14e9d8/graph)|
|basef+swapping|37.9|76.8||[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/fd42235b-0fa3-49cd-acf8-ef3c60f11287/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/fd42235b-0fa3-49cd-acf8-ef3c60f11287/graph)|
||||||
|**–ò–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**|||||
|basef+recomputations+suppress_gapler|32.0|72.6|–Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/b5794ce4-1b25-4b3f-9437-a15818a3ed2b/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/b5794ce4-1b25-4b3f-9437-a15818a3ed2b/graph)|
|basef+recomputations+resoure_variables|32.8|75.6|—Ç–æ–∂–µ –ø–ª–æ—Ö–æ|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/bf29dc93-ff74-476e-9396-a45f93083cf6/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/bf29dc93-ff74-476e-9396-a45f93083cf6/graph)|
|**base**+f{attn+lamb+ln+gelu}+bias_keys=True|30.8|78.6|—Ç—É—Ç –≤–∫–ª—é—á–∏–ª bias in keys, –¥–æ —ç—Ç–æ–≥–æ –Ω–µ –±—ã–ª–æ, —ç—Ñ—Ñ–µ–∫—Ç–∞ –ø–∞–º—è—Ç–∏ –Ω–µ—Ç—É, –∑–∞–º–µ–¥–ª–∏–ª–æ—Å—å|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/849c657f-a0b4-4aa8-ba93-17b4d643b746/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/849c657f-a0b4-4aa8-ba93-17b4d643b746/graph)|
|**base**+f{attn+lamb+ln+gelu}+atndrop=0.1|44.06|73.1|—ç—Ç–æ—Ç –æ—á –¥–æ—Ä–æ–≥–æ–π –ø–æ –ø–∞–º—è—Ç–∏ –¥—Ä–æ–ø–∞—É—Ç|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/5a7257b5-521d-4cee-b774-d841fe454fcb/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/5a7257b5-521d-4cee-b774-d841fe454fcb/graph)|
|**base**+f{attn+lamb+ln+gelu}+hiddrop=0.1|32.9|77.9|–Ω–∞ —Ö–∏–¥–¥–µ–Ω—ã –Ω–µ –æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–æ–π|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/c063504e-4dfa-4b89-ae5a-5fa6e8719ea2/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/c063504e-4dfa-4b89-ae5a-5fa6e8719ea2/graph)|
|base+f{attn+lamb+ln+gelu} = **optimal**|30.8|79.9|—Å—Ç–∞—Ä—ã–π –∑–∞–ø—É—Å–∫, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª —á—Ç–æ –æ–Ω —Ä–µ–∞–ª—å–Ω–æ –æ–ø—Ç–∏–º–∞–ª–µ–Ω|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/112c5349-b151-438a-b3df-89151691a890/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/112c5349-b151-438a-b3df-89151691a890/graph)|
|**optimal**+memopt=heuristic|31.7|76||[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/ea0e33b6-63b7-4ff9-9911-d65a5d532f07/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/ea0e33b6-63b7-4ff9-9911-d65a5d532f07/graph)|
|**optimal**+memopt=recomputation|31.7|76.4|–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –º–µ–º–æ—Ä–∏ —ç–≤—Ä–∏—Å—Ç–∏–∫ —Ç–æ–ª—å–∫–æ —É—Ö—É–¥—à–∞–µ—Ç –≤—Å–µ **–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω fused-gelu**|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/12f5768e-4e39-4026-8e37-03d8300bfb62/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/12f5768e-4e39-4026-8e37-03d8300bfb62/graph)|
|**optimal**+memopt=recomputation-fused_ln|33.5|78.4|—Ç—É—Ç –≤–∏–¥–Ω–æ —á—Ç–æ –≤—Å–µ-—Ç–∞–∫–∏ –µ—Å–ª–∏ —É–±—Ä–∞—Ç—å fused-ln —Ç–æ —Ö—É–∂–µ, –≤–∏–¥–∏–º–æ –≤–∫–ª—é—á–∏—Ç—å –µ–≥–æ –≤ —Å–æ–ª–æ –ø–ª–æ—Ö–æ, –≤–º–µ—Å—Ç–µ —Å –¥—Ä—É–≥–∏–º–∏ —Ñ—å–∑—é–¥–∞–º–∏ –æ–∫|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/da979d9f-2d5a-485d-a3ba-ff724d6c6b66/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/da979d9f-2d5a-485d-a3ba-ff724d6c6b66/graph)|
|**optimal**+memopt=recomputation-hvdfp16|31.7|76.3|—ç—Ñ—Ñ–µ–∫—Ç–∞ 0, –Ω–∞–¥–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–æ–¥–∞—Ö|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/98a8f8a7-782d-4e2e-b4ed-a88074c41ccb/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/98a8f8a7-782d-4e2e-b4ed-a88074c41ccb/graph)|
|**optimal**+split_opt_state|26.56|76||[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d29a8a7c-61ee-4537-a0e0-4ca42e8cb979/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d29a8a7c-61ee-4537-a0e0-4ca42e8cb979/graph)|
|**optimal**+gradaccumfp32|34.8|81.4|–¥–æ —ç—Ç–æ–≥–æ –∞–∫–∫—É–º—É–ª—è—Ü–∏–∏ –±—ã–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω—ã, –≤–∫–ª—é—á–∞–µ–º|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/169c500c-722d-4be9-88da-3e41812e4ca1/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/169c500c-722d-4be9-88da-3e41812e4ca1/graph)|
|**optimal**+gradaccumfp16=optimal|32.6|81.9|—Ç—É—Ç –≤—Å–µ –ª–æ–≥–∏—á–Ω–æ|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/f4eb2689-51af-4303-828a-2a8e0f6212a5/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/f4eb2689-51af-4303-828a-2a8e0f6212a5/graph)|
|**optimal+**s/lamb/adamw/g|33.93|78.1|adamw —Ö—É–∂–µ –ø–æ –ø–µ—Ä—Ñ—É —á–µ–º Fused-lamb|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/43202d0a-7b18-4a63-a4af-248aa0f0a50e/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/43202d0a-7b18-4a63-a4af-248aa0f0a50e/graph)|
|**optimal**+zero1+gaccum16|28.4|80.1|–ø–æ–¥ zero1 –∏–º–µ—é –≤–≤–∏–¥—É|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/3c7636f1-7a96-4c25-a1a1-c1d92ee1b99b/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/3c7636f1-7a96-4c25-a1a1-c1d92ee1b99b/graph)|
|**optimal**+zero2+gaccum16=**optimald**|26.61|81||[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d9e2ba3a-d51f-4c10-a895-ebce675c6f44/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d9e2ba3a-d51f-4c10-a895-ebce675c6f44/graph)|
|**optimald**+tp=4|17.88|28.3|—Å–∫–æ—Ä–æ—Å—Ç—å –¥–∏–∫–æ –ø–∞–¥–∞–µ—Ç –∫–æ–Ω–µ—á–Ω–æ, –Ω–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–ø–∏—Ö–Ω—É—Ç—å –±–æ–ª—å—à—É—é –º–æ–¥–µ–ª—å–∫—É.|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/f997190b-c83b-4d41-8936-cde9d0275be3/graph/FlowchartBlockOperation/code/pydl_pulsar](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/f997190b-c83b-4d41-8936-cde9d0275be3/graph/FlowchartBlockOperation/code/pydl_pulsar)|
|**optimald**+tp=2|25.7|38.144|–ó–∞–º–µ—á—É, —á—Ç–æ —á—Ç–æ–±—ã –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤ –Ω–∏—Ä–≤–∞–Ω–µ –Ω–∞–¥–æ —Å–∫–µ–ª–∏—Ç—å mpi_runners=8/tp –∏ –≤—ã–∫–ª—é—á–∞—Ç—å fused-ln –∏ softmax, —Ç–∫ –æ–Ω–∏ —Å–µ–π—á–∞—Å –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã —Å tp. –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è tp=2 —Ç–µ—Ä—è–µ—Ç –≤–µ—Å—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏—Ç –∏–∑-–∑–∞ –≤—ã–∫–ª—é—á–µ–Ω–∏—è —Ñ—å—é–∑–¥–æ–≤|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/783bf06a-dac1-4192-be54-e0f0446ef181/graph/FlowchartBlockOperation/code/pydl_pulsar](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/783bf06a-dac1-4192-be54-e0f0446ef181/graph/FlowchartBlockOperation/code/pydl_pulsar)|
||||||
|Go ~~wider~~ deeper|||||
|xlarge(l=24,h=2048)-1.4B|20.6|13|bs=8, seq_len=512|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/fe157074-3e34-41f5-859a-eb55016ab6af/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/fe157074-3e34-41f5-859a-eb55016ab6af/graph)|
|xlarge|54.1|16.9|bs=32|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/554c612a-5957-46e4-8c53-f26f14c81fdf/graph/FlowchartBlockOperation/code/pydl_pulsar](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/554c612a-5957-46e4-8c53-f26f14c81fdf/graph/FlowchartBlockOperation/code/pydl_pulsar)|
|xlarge|52|16|bs=32, nodes=4, check zero|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d092cae7-2d00-4e8d-b2bc-cdfa6b95ce7c/graph/FlowchartBlockOperation/code/pydl_pulsar](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d092cae7-2d00-4e8d-b2bc-cdfa6b95ce7c/graph/FlowchartBlockOperation/code/pydl_pulsar)|
|xlarge, sparse_as_dense=False|54.23|16.7|bs=32,, –∏ –º–µ–¥–ª–µ–Ω–µ–µ –∏ –ø–æ –ø–∞–º—è—Ç–∏ —Ö—É–∂–µ|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/fd105262-cf35-452f-ae93-b6bba3c08702/graph/FlowchartBlockOperation/code/pydl_pulsar](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/fd105262-cf35-452f-ae93-b6bba3c08702/graph/FlowchartBlockOperation/code/pydl_pulsar)|
|xlarge-ytf_softmax|60.4|15.7|bs=24, 32 –Ω–µ –ª–µ–∑, —É–±–∏—Ä–∞–µ–º softmax-ytf|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/aa45f266-44d1-4c48-a2d1-032728edc412/graph/FlowchartBlockOperation/code/pydl_pulsar](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/b65eff67-d8dd-4895-87bf-0ea001457f1b/graph/FlowchartBlockOperation/code/pydl_pulsar)|
|xlarge+hid_dropout|45.1|16.0|bs=24, –¥–µ—à–µ–≤–∞—è —à—Ç—É–∫–∞, –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/09eca334-a3ce-4ac6-af94-765ea0aa1a2d/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/09eca334-a3ce-4ac6-af94-765ea0aa1a2d/graph)|
|xlarge+attn_dropout|61.55|14.93|bs=24, –∂—Ä–µ—Ç —Ç–æ–Ω–Ω—É –ø–∞–º—è—Ç–∏|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/81a99e4f-6a12-4b7c-ba8a-228817723d71/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/81a99e4f-6a12-4b7c-ba8a-228817723d71/graph)|
||||||
|x?large(l=48,h=2048)-2.6B|39.6|6.9|bs=8|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/dcda1029-c3eb-49e3-a524-d2dd3d32bc9f/graph/FlowchartBlockOperation/code/pydl_pulsar](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/dcda1029-c3eb-49e3-a524-d2dd3d32bc9f/graph/FlowchartBlockOperation/code/pydl_pulsar)|
|x?large(l=48,h=2048)|60.61|7.93|bs=16|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/ae11338b-cc6f-489e-8c90-349fb5600b1e/graph/FlowchartBlockOperation/code/pydl_pulsar](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/ae11338b-cc6f-489e-8c90-349fb5600b1e/graph/FlowchartBlockOperation/code/pydl_pulsar)|
||||||
||||||
||||||
|x?large(l=64,h=2560)|-|-|–ø—Ä–æ–±–æ–≤–∞–ª –ø–æ —Ä–∞–∑–Ω–æ–º—É –∑–∞–ø—É—Å–∫–∞—Ç—å, –Ω–µ–≤–µ–¥–æ–º–∞—è –±–∞–≥–∞ —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –≤ —Ö–æ—Ä–æ–≤–æ–¥–µ. [https://paste.yandex-team.ru/4647a7d3-2714-4c64-b33d-46217bd98cb6](https://paste.yandex-team.ru/4647a7d3-2714-4c64-b33d-46217bd98cb6)|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/16f61ae1-f6c1-4baa-ac7d-8ce5a8c05ff5/graph/FlowchartBlockOperation/code/pydl_pulsar](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/16f61ae1-f6c1-4baa-ac7d-8ce5a8c05ff5/graph/FlowchartBlockOperation/code/pydl_pulsar)|
|x?large(l=64,h=2048)-3.4B|52.45|5.2||[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d91f38ed-f869-4bab-a9d9-bd71ca8961c0/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d91f38ed-f869-4bab-a9d9-bd71ca8961c0/graph)|
|x?large(l=48,h=2560)|-|-|—Ç–∞ –∂–µ –±–∞–≥–∞, —Å —Ç–µ–º –∂–µ —Ö–∏–¥–¥–µ–Ω–æ–º, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å –Ω–∏–º(–±–æ–ª—å—à–µ –∏ –º–µ–Ω—å—à–µ —Ä–∞–±–æ—Ç–∞—é—Ç). –ù–µ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å hidden=2560||
|x?large(l=48,h=3072)-5.75B|71|3.8|batch=8|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/91d3fa10-dcd8-48e2-825a-7b81ef93ba59/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/91d3fa10-dcd8-48e2-825a-7b81ef93ba59/graph)|
||||||

goal - 3-5

  

  

–ø–æ–ø—ã—Ç–∫–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –æ–±—É—á–µ–Ω–∏–µ —Å –±–æ–ª—å—à–∏–º –±–∞—á–æ–º

- —Ä–µ–∞–ª—å–Ω–∞—è –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –Ω–∞ 80–ì–±

  

–ò—Ç–æ–≥–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤:

- –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è large - [https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d9e2ba3a-d51f-4c10-a895-ebce675c6f44/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d9e2ba3a-d51f-4c10-a895-ebce675c6f44/graph)
- –û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è xlarge - [https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d092cae7-2d00-4e8d-b2bc-cdfa6b95ce7c/graph/](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/d092cae7-2d00-4e8d-b2bc-cdfa6b95ce7c/graph/)

  

–ù–∞–±–æ—Ä –≤–æ–∑–º–æ–∂–Ω–æ –Ω–µ–æ—á–µ–≤–∏–¥–Ω—ã—Ö –ª–∞–π—Ñ—Ö–∞–∫–æ–≤ –∫–æ—Ç–æ—Ä—ã–π —É–¥–∞–ª–æ—Å—Ç—å –Ω–∞–π—Ç–∏:

- –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ fused-gelu(–∞ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å), —Ç–æ –º–æ–∂–Ω–æ –≤—ã—Ä—É–±–∞—Ç—å memory_optimization(–æ–ø—Ü–∏—è no)
- fused-ln –±–µ–∑ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ—å—é–∑–¥–æ–≤ –ª—É—á—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
- FusedLAMB –ª—É—á—à–µ AdamW –≤–æ –≤—Å–µ–º
- –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥—Ä–æ–ø–∞—É—Ç—ã –∏ —É –≤–∞—Å seq_len –±–æ–ª—å—à–æ–π, —Ç–æ attn_dropout –æ—á –¥–æ—Ä–æ–≥–æ–π. –î–ª—è xlarge –Ω–∞–ø—Ä–∏–º–µ—Ä —Ç–æ–ª—å–∫–æ –æ–Ω –∂—Ä–∞–ª ~20Gb, –≤–æ–∑–º–æ–∂–Ω–æ –º–æ–∂–Ω–æ –∫–æ–º–ø–µ–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ hid_dropout, –æ–Ω —Å–∏–ª—å–Ω–æ –º–µ–Ω—å—à–µ –µ—Å—Ç.
- –ï—Å–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç–µ –±–∞—á/–¥–ª–∏–Ω—É/–∏—Ç–¥ —Å–º–æ—Ç—Ä—è –Ω–∞ [–ª–æ–≥–∏ –ø–∞–º—è—Ç–∏](https://a.yandex-team.ru/review/3133836/details), —Ç–æ —Å—Ç–æ–∏—Ç –æ–∂–∏–¥–∞—Ç—å –æ—Ç GPU –Ω–µ –≤—Å–µ 80–ì–± –ø–∞–º—è—Ç–∏, –∞ —á—É—Ç—å –º–µ–Ω—å—à–µ(—É—Å–ª–æ–≤–Ω–æ 70-75). –í–ø—Ä–∏—Ç—ã–∫ –∑–∞–ø–∏—Ö–∞—Ç—å –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –∏–∑-–∑–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ RAM.

  

–£–ø–∏—Ö–∏–≤–∞–µ–º l=48,h=3072

|   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|
|bs|all bs|nodes|seq_len|per gpu samples/sec|all samples/sec|tokens/sec|memory|days|
|8|128|1|512|3.8|30.4|15.5K|71||
|8|1536|6|512|6.75|324|165K|60.5||
|8|1536|6(naive)|512|6,36|305.4|156K|66.7||
|8|1536|6(greedy:8)|512|6.34|304|156K|75,6||
|8|1536|6(greedy:16)|512|6.36|305|156K|68.3||
||||||||||
|8|24K|24(gac=16)|512|6.52|1251|640K|58||
|8|32–ö|32(gac=16)|512|6.37|1630|835–ö|58||

–¥–ª—è 32-—Ö –Ω–æ–¥ –ø—Ä–∏—à–ª–æ—Å—å —Å—Ç–∞–≤–∏—Ç—å yt_readers=2 –∏ –∫–æ—Å—Ç—ã–ª—è—Ç—å —Ç–∞–π–º–∞—É—Ç—ã –≤ yt

  

–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –æ–±—É—á–µ–Ω–∏—è —Å—Ç–∞—Ä—ã—Ö –º–æ–¥–µ–ª–µ–∫ —Å –±–û–ª—å—à–∏–º –±–∞—á–æ–º

- prepretrain - –Ω–∞ V100
- pretrain - –±–µ–∑ ZERO
- post-train - –±–µ–∑ ZERO

  

  

  

|config|maxmem|graph|
|---|---|---|
|old-porto-xlarge-bs=16|55|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/a6c21c45-a6a4-4d1c-bfeb-568dadfd38a3/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/a6c21c45-a6a4-4d1c-bfeb-568dadfd38a3/graph)|
|new-porto-xlarge-bs=24|59|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/475a4057-99da-482d-b591-2d96089de041/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/475a4057-99da-482d-b591-2d96089de041/graph)|
||||
||||

  

## PrePreTrain(seq_len=512)

  

–ü–æ–ø—ã—Ç–∞–µ–º—Å—è —É–ø–∏—Ö–∞—Ç—å l=48,h=3072, 5.75–í –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –≤—ã–∂–∞—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –Ω–∞ –ø—Ä–µ–ø—Ä–µ—Ç—Ä–µ–π–Ω–µ —Å seq_len=512.

|   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|
|‚Ññ|bs|all bs|nodes|per gpu samples/sec|all samples/sec|tokens/sec|memory|graph|
|1|8|128|1|7.6|60.8|31K|71|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/91d3fa10-dcd8-48e2-825a-7b81ef93ba59/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/91d3fa10-dcd8-48e2-825a-7b81ef93ba59/graph)|
|2|8|1536|6|6.75|324|165K|60.5|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/df9a6d88-e82a-4ee0-8496-2924bd02e933/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/df9a6d88-e82a-4ee0-8496-2924bd02e933/graph)|
|3|8|1536|6(naive-all)|6,36|305.4|156K|66.7|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/9f697d34-0f7e-4259-814d-f534470df400/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/9f697d34-0f7e-4259-814d-f534470df400/graph)|
|4|8|1536|6(greedy:8)|6.34|304|156K|75,6|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/adb382c5-c216-4215-9896-84465c2f8fa6/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/adb382c5-c216-4215-9896-84465c2f8fa6/graph)|
|5|8|1536|6(greedy:16)|6.36|305|156K|68.3|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/b50c1e07-edb7-4b6c-b51b-712f9f5c1216/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/b50c1e07-edb7-4b6c-b51b-712f9f5c1216/graph)|
|6|||||||||
|7|8|24K|24(gac=16)|6.52|1251|640K|58|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/e31569db-eb8c-47d0-85ca-1c2836e74595/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/e31569db-eb8c-47d0-85ca-1c2836e74595/graph)|
|8|8|32–ö|32(gac=16)|6.37|1630|835–ö|58|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/ef84bfdc-6287-40ed-a167-f298b9925930/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/ef84bfdc-6287-40ed-a167-f298b9925930/graph)|

–¢—É—Ç –æ–ø–∏—à—É –ª–æ–≥–∏–∫—É –∏ –ø–æ—á–µ–º—É –±–æ–ª—å—à–µ —Å–µ–π—á–∞—Å –Ω–µ –≤—ã–∂–∞—Ç—å:

- –í –æ–¥–∏–Ω —Ö–æ—Å—Ç –ª–µ–∑–µ–º —Å zero-2 –≤–ø—Ä–∏—Ç—ã–∫ —Å –±–∞—á–æ–º 8
- —Ç—Ä–µ–∫–∏–Ω–≥ –ø–∞–º—è—Ç–∏ —Ç—É—Ç —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –Ω–µ –æ—á–µ–Ω—å —á–µ—Å—Ç–Ω—ã–π, –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞—Ç—Ä–∞—Ç—ã 0-–π GPU(–≤ DP —ç—Ç–æ –æ–∫, –≤ ZERO –Ω–µ—Ç)
- –¥–∞–ª–µ–µ —Å–∫–µ–π–ª–∏–º—Å—è –¥–æ 6 —Ö–æ—Å—Ç–æ–≤ —Ç–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ zero –ø—Ä–∏ naive –∏–¥–µ—Ç –Ω–æ–º–µ—Ä —Å–ª–æ—è ‚Üí –Ω–æ–º–µ—Ä –≥–ø—É, –∞ —Å–ª–æ–µ–≤ 48. –î–∞–ª–µ–µ –ø–æ–Ω—è–ª, —á—Ç–æ —Ç–∞–∫ —Ç–æ–∂–µ –ø–ª–æ—Ö–æ —Ç–∫ –º–∞—Ç—Ä–∏—Ü–∞ —ç–º–±–µ–¥–∏–Ω–≥–æ–≤ –ø–∏—Ö–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –≥–ø—É. –ï—â–µ –ø–æ–∑–∂–µ –ø–æ–Ω—è–ª, —á—Ç–æ –ø–æ —É–º–Ω–æ–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—å —Å–ª–æ–∏ –∏ –∏—Ö —Ç–µ–Ω–∑–æ—Ä—ã –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞. –ú–∞—Ç—Ä–∏—Ü–∞ —ç–º–±–µ–¥–∏–Ω–≥–æ–≤ –≤ –¥–∞–Ω–Ω–æ–º —Å—ç—Ç–∞–ø–µ - 316 –º–ª–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –æ–¥–∏–Ω —Å–ª–æ–π - 113 –º–ª–Ω. –ü–æ—ç—Ç–æ–º—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ –ø–∞–º—è—Ç–∏ –±—É–¥–µ—Ç –Ω–∞ —Ç–æ–π –≥–ø—É, –≥–¥–µ –ª–µ–∂–∏—Ç –º–∞—Ç—Ä–∏—Ü–∞ —ç–º–±–µ–¥–∏–Ω–≥–æ–≤. –ü–æ—ç—Ç–æ–º—É –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TP –Ω–∞ –º–∞—Ç—Ä–∏—Ü—É —ç–º–±–µ–¥–∏–Ω–≥–æ–≤ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ —Ä–∞—Å—Ö–æ–¥–æ–≤–∞—Ç—å –ø–∞–º—è—Ç—å –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è.
- 3-5 —Ä–∞–Ω –≥–æ–Ω—è–ª–∏—Å—å —Å trunk —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º attention-softmax, –ø–æ—ç—Ç–æ–º—É –ø–∞–º—è—Ç—å —Ç–∞–º –Ω–µ–º–Ω–æ–≥–æ —Ö—É–∂–µ –≤—ã—Ö–æ–¥–∏—Ç
- —Ç–∫ —É –Ω–∞—Å ZERO —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–µ –ø–æ –≥—Ä—É–ø–ø–∞–º, –∞ –≤ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –≤ –∫–æ—Ç–æ—Ä–æ–π –æ–¥–Ω–∞ –≥—Ä—É–ø–ø–∞ –≤–ª–∞–¥–µ—é—â–∏—Ö —Ä–∞–∑–¥–∞–µ—Ç –≤—Å–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Ç–æ —Ä–∞–∑–Ω–∏—Ü—ã –≤ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∏–∫–∞–∫–æ–π –Ω–µ—Ç—É –æ—Ç —Å–º–µ–Ω—ã split_strategy. —Ç–∫ –±–∞—á 16 –Ω–µ –ª–µ–∑–µ—Ç –Ω–∏ –≤ –∫–∞–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–º—ã—Å–ª–∞ –æ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–π —Å–ø–ª–∏—Ç–∞ –¥–ª—è –¥–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏ –Ω–µ –±—ã–ª–æ, –æ—Å—Ç–∞–≤–∏–ª –¥–µ—Ñ–æ–ª—Ç–Ω—É—é
- –¥–ª—è 32-—Ö –Ω–æ–¥ –ø—Ä–∏—à–ª–æ—Å—å —Å—Ç–∞–≤–∏—Ç—å yt_readers=2 –∏ –∫–æ—Å—Ç—ã–ª—è—Ç—å —Ç–∞–π–º–∞—É—Ç—ã –≤ yt. –ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ —á—Ç–æ –Ω–∞ 24-—Ö –≤—Å–µ—Ö —ç—Ç–∏—Ö –ø—Ä–æ–±–ª–µ–º –Ω–µ –±—ã–ª–æ
- 50–∫ —à–∞–≥–æ–≤ –∏—Ç–æ–≥–æ –∑–∞ ~11.6 –¥–Ω—è –Ω–∞ 32-—Ö —Ö–æ—Å—Ç–∞—Ö(–±–µ–∑ —É—á–µ—Ç–∞ —Ä–µ—Å—Ç–∞—Ä—Ç–æ–≤, –¥–∏–Ω –±–∞—á–∞ –∏ –¥–∏–Ω —à–µ–¥—É–ª–µ—Ä–∞)

  

–ü–æ–¥—É–º–∞–ª–∏ –∏ —Ä–µ—à–∏–ª–∏ –≤–∑—è—Ç—å –º–æ–¥–µ–ª—å –ø–æ–º–µ–Ω—å—à–µ —á—Ç–æ–±—ã –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –æ–±—É—á–∏—Ç—å –∏ –∏–º–µ—Ç—å –ø—Ä–∞–≤–æ –Ω–∞ –æ—à–∏–±–∫—É, —Ç–æ–∂–µ —Å–∞–º–æ–µ –Ω–æ 36 —Å–ª–æ–µ–≤, –≤—ã—Ö–æ–¥–∏—Ç 4.4–í –≤–º–µ—Å—Ç–æ 5.75–í.

|   |   |   |   |   |   |   |   |   |
|---|---|---|---|---|---|---|---|---|
|‚Ññ|bs|all bs|nodes|per gpu samples/sec|all samples/sec|tokens/sec|memory|graph|
|1|8|6144|6|10.29|493|252–ö|44.5|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/102d31cd-2df0-47c1-8b96-2a0bd8d6cd3e/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/102d31cd-2df0-47c1-8b96-2a0bd8d6cd3e/graph)|
|2|16|24–ö|24|13.05|2506|1.28–ú|69.3|[https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/08c28b3b-d479-409a-8c32-617a6d9bbf2a/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/08c28b3b-d479-409a-8c32-617a6d9bbf2a/graph)|

## Fine-Tunes

  

—Ñ–∞–π–Ω-—Ç—å—é–Ω—ã –ª–µ–∑—É—Ç

—Ñ–∏–∫—Å [–±–∞–≥–∏](https://paste.yandex-team.ru/1b15cb55-eff1-4e86-9a69-6db67bca57ce) ?

  

## PreTrain(seq_len=192)

[https://nirvana.yandex-team.ru/flow/f01d70e2-059a-485d-a1d2-3f80bfcec671/d63f5451-0874-4ddb-b7bd-af95ce3eee90/graph](https://nirvana.yandex-team.ru/flow/f01d70e2-059a-485d-a1d2-3f80bfcec671/d63f5451-0874-4ddb-b7bd-af95ce3eee90/graph)

  

|   |   |   |   |   |
|---|---|---|---|---|
|config|maxmem|per gpu samples/sec|all samples/sec|graph|
|bs=48,gac=2,nodes=4|65|33.6|1075|[https://nirvana.yandex-team.ru/flow/019a69a4-9b38-463f-a84a-3b85b3cd135a/985b7506-c8b3-4f0b-b35c-b564625ccb1e/graph](https://nirvana.yandex-team.ru/flow/019a69a4-9b38-463f-a84a-3b85b3cd135a/985b7506-c8b3-4f0b-b35c-b564625ccb1e/graph)|

  

XXLarge vs XLarge

|   |   |   |
|---|---|---|
|params|X-Large|XX-Large|
|**PrePreTrain**|||
|per-gpu batch|8(V-100)|16|
|batch|12K|24K|
|gpus|64|192|
|steps|50K|50k|
|steps/sec|0.058|0.059|
|train days|~12|est 9.8|
|graph|[https://nirvana.yandex-team.ru/flow/2de4394e-40a5-404d-a974-b4ddd6dbcef0/e6508cd6-0dca-4a6e-b078-9301edcaa9bd/graph](https://nirvana.yandex-team.ru/flow/2de4394e-40a5-404d-a974-b4ddd6dbcef0/e6508cd6-0dca-4a6e-b078-9301edcaa9bd/graph)|1k steps - [https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/1c1d87c6-635c-43b6-9290-0079484289d0/graph](https://nirvana.yandex-team.ru/flow/a6cc89ab-be92-4e00-980a-9b8af47a3ee2/08c28b3b-d479-409a-8c32-617a6d9bbf2a/graph)|
||||
|**PreTrain**|||
|per-gpu batch|24|48|
|batch|24K|18K|
|gpus|256|256|
|steps|450K|450K|
|steps/sec|0,386|0.2062|
|train days|>10|25|
|graph|[https://nirvana.yandex-team.ru/flow/f01d70e2-059a-485d-a1d2-3f80bfcec671/d63f5451-0874-4ddb-b7bd-af95ce3eee90/graph](https://nirvana.yandex-team.ru/flow/f01d70e2-059a-485d-a1d2-3f80bfcec671/d63f5451-0874-4ddb-b7bd-af95ce3eee90/graph)|[https://nirvana.yandex-team.ru/flow/45aad71b-9b20-42b7-94bf-4ef951ec7029/b225ca99-5d0a-466c-bf87-53b0ac7c790d/graph](https://nirvana.yandex-team.ru/flow/45aad71b-9b20-42b7-94bf-4ef951ec7029/b225ca99-5d0a-466c-bf87-53b0ac7c790d/graph)|
|comment||–¥—É–º–∞—é –ø–æ–ª—É—á–∏—Ç—Å—è –µ—â–µ —É—Å–∫–æ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –Ω–∞ 10|
||||
||||